SET SCHEMA STAGING_<env>;

CREATE OR REPLACE VIEW V_COL_ERROR_CHECK_NORMA_STAGING AS
(
    SELECT
        SRA.LINE_NUMBER
        , 3              AS COL_NUMBER
        , SRA.SUBSIDIARY ||'-'|| SRA.SUBLEDGER      AS COL_VALUE
        , 67             AS ERROR_MESSAGE_ID
    FROM STAGING_RISK_ADJUSTMENT SRA
    LEFT OUTER JOIN BI_<env>.TESB  TESB ON (SRA.SUBSIDIARY || '-' || SRA.SUBLEDGER) = (TESB.SSD_CF || '-' || TESB.ESB_CF) AND TESB.LIFE_CF =2
    WHERE (TESB.ESB_CF IS NULL OR TESB.SSD_CF IS NULL)  AND (TRIM(SRA.SUBSIDIARY)<>'') AND (TRIM(SRA.SUBLEDGER)<>'' ) 
UNION
    SELECT
        SRA.LINE_NUMBER
        , 4              AS COL_NUMBER
        , SRA.LOB_N1     AS COL_VALUE
        , 74             AS ERROR_MESSAGE_ID
    FROM STAGING_RISK_ADJUSTMENT SRA
    LEFT OUTER JOIN BI_<env>.LOB_N1  TLOB ON (SRA.LOB_N1 = TLOB.LOB_N1 AND TLOB.LANGUAGE='E')
    WHERE (TLOB.LOB_N1 IS NULL )
UNION
    SELECT
        SRA.LINE_NUMBER
        , 5              AS COL_NUMBER
        , SRA.NATURE     AS COL_VALUE
        , 63             AS ERROR_MESSAGE_ID
    FROM STAGING_RISK_ADJUSTMENT SRA
    WHERE CASE WHEN TRIM(SRA.NATURE)='' THEN SRA.LOB_N1 NOT in ('3021','3011') ELSE SRA.NATURE NOT IN ('F','N','P') end
UNION 
    SELECT
        SRA.LINE_NUMBER
        , 7             AS COL_NUMBER
        , SRA.DOMAIN_CODE     AS COL_VALUE
        , 75             AS ERROR_MESSAGE_ID
    FROM STAGING_RISK_ADJUSTMENT SRA
    WHERE SRA.DOMAIN_CODE NOT IN ('Gross','RetroNP')
UNION
  SELECT
        SRA.LINE_NUMBER
        , 7             AS COL_NUMBER
        , SRA.DOMAIN_CODE ||'-'|| SRA.NATURE   AS COL_VALUE
        , 76             AS ERROR_MESSAGE_ID
    FROM STAGING_RISK_ADJUSTMENT SRA
    WHERE SRA.NATURE NOT in ('N','') and SRA.DOMAIN_CODE = 'RetroNP'
)
;