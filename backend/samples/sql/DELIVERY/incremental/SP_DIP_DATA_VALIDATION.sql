DROP PROCEDURE DELIVERY_<env>.SP_DIP_DATA_VALIDATION;

CREATE PROCEDURE DELIVERY_<env>.SP_DIP_DATA_VALIDATION(IN P_REQUESTID BIGINT DEFAULT 0,
IN P_STATUSID INTEGER DEFAULT 147,
IN P_USERID VARCHAR(10) DEFAULT 'XYZ')
SPECIFIC DELIVERY_<env>.SP_DIP_DATA_VALIDATION RESULT SETS 1
MODIFIES SQL DATA
NOT
DETERMINISTIC NULL CALL
LANGUAGE SQL EXTERNAL ACTION
INHERIT SPECIAL REGISTERS
BEGIN
DECLARE v_RequestID BIGINT;

DECLARE v_BU_ValidStatusID SMALLINT;

DECLARE v_UserID VARCHAR (10);

DECLARE v_SystemID SMALLINT;


SET v_RequestID = P_REQUESTID;


SET v_BU_ValidStatusID = P_STATUSID;


SET v_UserID = UPPER (TRIM (P_USERID));


SELECT
   RDWH_B
INTO    v_SystemID
FROM    DELIVERY_<env>.UPLOAD_REQUEST
WHERE    REQUEST_ID = P_REQUESTID;


CASE v_SystemID WHEN 1 THEN
UPDATE
   DELIVERY_<env>.UPLOAD_REQUEST
SET    BUSINESS_VALIDATION_STATUS_ID = v_BU_ValidStatusID,
   VALIDATION_DATE = CURRENT_TIMESTAMP,
   BUSINESS_USER_ID = v_UserID
WHERE    REQUEST_ID = v_RequestID
   AND BUSINESS_VALIDATION_STATUS_ID = 147;


COMMIT;

ELSE
BEGIN
END;

END
CASE;

BEGIN
DECLARE C1 CURSOR WITH RETURN FOR
SELECT
   REQUEST_ID,
   FILE_NAME,
   MODELLING_REGION_ID,
   QUARTER_ID,
   TYPE_OF_PROJECTION_ID,
   RDWH_B,
   SOURCE_SYSTEM_ID,
   UPLOAD_TYPE_ID,
   INSERT_DATE,
   PROCESSED_DATE,
   VALIDATION_STATUS_ID,
   BUSINESS_VALIDATION_STATUS_ID,
   VALIDATION_DATE,
   BUSINESS_USER_ID,
   MAIN_REQUEST_ID
FROM    DELIVERY_<env>.UPLOAD_REQUEST;


OPEN C1;

END;

END;
