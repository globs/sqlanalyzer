CREATE OR REPLACE PROCEDURE SP_BATCH_GROUPING_MU_RDWH() RETURNS INTEGER
   LANGUAGE nzplsql AS BEGIN_PROC

DECLARE VAR_BATCH_GROUPING_ID INT;
L_ERR_CD				CHAR(5);
L_ERR_MSG				VARCHAR(32000);


BEGIN
SET ISOLATION TO UR;

SELECT BATCH_GROUPING_ID INTO VAR_BATCH_GROUPING_ID FROM BATCH_GROUPING WHERE BATCH_GROUPING_NAME = 'MU RDWH STAGING PROCESSING';
		
UPDATE EVENT_MAPPING SET BATCH_GROUPING_ID = VAR_BATCH_GROUPING_ID WHERE EVENT_CODE IN ('EVT_INGEST_MU_APAC_CASHFLOWS_FOR_VALIDATION'
, 'EVT_INGEST_MU_CANADA_CASHFLOWS_FOR_VALIDATION', 'EVT_INGEST_MU_FRGE_CASHFLOWS_FOR_VALIDATION'
, 'EVT_INGEST_MU_UK_CASHFLOWS_FOR_VALIDATION', 'EVT_INGEST_MU_US_CASHFLOWS_FOR_VALIDATION');

SELECT BATCH_GROUPING_ID INTO VAR_BATCH_GROUPING_ID FROM BATCH_GROUPING WHERE BATCH_GROUPING_NAME = 'RDWH HISTORIZATION PROCESSING';

UPDATE EVENT_MAPPING SET BATCH_GROUPING_ID = VAR_BATCH_GROUPING_ID WHERE EVENT_CODE IN ('EVT_MU_APAC_CASHFLOWS_VALIDATED', 'EVT_MU_CANADA_CASHFLOWS_VALIDATED'
, 'EVT_MU_FRGE_CASHFLOWS_VALIDATED', 'EVT_MU_UK_CASHFLOWS_VALIDATED', 'EVT_MU_US_CASHFLOWS_VALIDATED');

DELETE FROM EVENT_MAPPING WHERE EVENT_CODE IN ('EVT_INGEST_MU_CASHFLOWS_FOR_VALIDATION', 'EVT_MU_CASHFLOWS_VALIDATED');

EXCEPTION WHEN OTHERS THEN 
	L_ERR_CD := SUBSTR(SQLERRM, 8, 5); 
	L_ERR_MSG := SQLERRM; 
	RAISE EXCEPTION '% Error while executing SQL statement', L_ERR_MSG; 
	RETURN L_ERR_CD;
 
END; 

END_PROC;