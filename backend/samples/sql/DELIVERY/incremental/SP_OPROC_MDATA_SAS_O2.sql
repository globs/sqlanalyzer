CREATE OR REPLACE PROCEDURE SP_ORCHESTRATION_PROCESS_METADATA_FOR_SAS () RETURNS INTEGER
   LANGUAGE nzplsql AS BEGIN_PROC

DECLARE VAR_ORCHESTRATION_PROCESS_ID INT ;
VAR_ORCHESTRATION_PROCESS_STEP_ID_01 INT ;
VAR_ORCHESTRATION_PROCESS_STEP_ID_02 INT ;
VAR_BATCH_GROUPING_ID INT ;
VAR_BATCH_GROUPING1_ID INT ;
VAR_BATCH_ID INT;
VAR_JOB_GROUP_ID_01 INT;
VAR_JOB_GROUP_ID_02 INT;
VAR_JOB_ID_01 INT ;
VAR_JOB_ID_02 INT ;
VAR_JOB_ID_03 INT ;
VAR_JOB_ID_04 INT ;
VAR_JOB_ID_05 INT ;
VAR_JOB_ID_06 INT ;
VAR_JOB_ID_07 INT ;
VAR_STEP_01 INT;
VAR_STEP_02 INT;
VAR_STEP_03 INT;
VAR_STEP_04 INT;
VAR_STEP_05 INT;
VAR_STEP_06 INT;
VAR_DATA_VALIDATION_CONTROL_ID INT ;
VAR_DATA_VALIDATION_CONTROL_MAPPING_ID INT ;

L_ERR_CD				CHAR(5);
L_ERR_MSG				VARCHAR(32000);

BEGIN
SET ISOLATION TO UR;


SET VAR_ORCHESTRATION_PROCESS_ID  = NEXT VALUE FOR SEQUENCE_ORCHESTRATION_PROCESS_METADATA;
SET VAR_ORCHESTRATION_PROCESS_STEP_ID_01  = NEXT VALUE FOR SEQUENCE_ORCHESTRATION_PROCESS_METADATA;
SET VAR_BATCH_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_GROUP_ID_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_GROUP_ID_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_04  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_05  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_06  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_07  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO ORCHESTRATION_PROCESS (ORCHESTRATION_PROCESS_ID, ORCHESTRATION_PROCESS_NAME, ORCHESTRATION_PROCESS_DESCRIPTION, INSTANCE_TYPE) VALUES
(VAR_ORCHESTRATION_PROCESS_ID, 'Orchestration Process for DIP to SAS to DIP data flow', 'Orchestration Process for DIP to SAS to DIP data flow', null);

INSERT INTO ORCHESTRATION_PROCESS_STEP (ORCHESTRATION_PROCESS_STEP_ID, ORCHESTRATION_PROCESS_ID, ORCHESTRATION_PROCESS_STEP_NAME, CHILD_BATCH_ID, TRIGGER_DEPENDENT_STEPS, STARTING_STEP, OPTIONAL_RUN) VALUES
(VAR_ORCHESTRATION_PROCESS_STEP_ID_01, VAR_ORCHESTRATION_PROCESS_ID, 'Orchestration Process Step for DIP to SAS', VAR_BATCH_ID, NULL, TRUE, FALSE);


INSERT INTO BATCH (BATCH_ID,BATCH_NAME, BATCH_DESCRIPTION, APPLICATION_NAME, BATCH_PRIORITY, ON_ERROR, PRE_BATCH_PROCESSING, POST_BATCH_PROCESSING) VALUES
(VAR_BATCH_ID, 'DIP to SAS Run', 'DIP to SAS Run', 'DIP', 1, NULL, NULL, 'api-dip:dipToSasServiceFile');

INSERT INTO JOB_GROUP (JOB_GROUP_ID, JOB_GROUP_NAME, BATCH_ID, PARENT_JOB_GROUP_ID) VALUES
(VAR_JOB_GROUP_ID_01, 'Extract TRT and Quotes Data for SAS Run Job Group', VAR_BATCH_ID, NULL);

INSERT INTO JOB_GROUP (JOB_GROUP_ID, JOB_GROUP_NAME, BATCH_ID, PARENT_JOB_GROUP_ID) VALUES
(VAR_JOB_GROUP_ID_02, 'Extract CF, RA, CU, RTL, GL Data for SAS Run Job Group', VAR_BATCH_ID, VAR_JOB_GROUP_ID_01);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_01, 'Extract Assumed Treaty Char. for SAS', NULL, VAR_JOB_GROUP_ID_01, NULL, NULL, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_02, 'Extract Quotes for SAS', NULL, VAR_JOB_GROUP_ID_01, NULL, NULL, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_03, 'Extract Cashflows for SAS', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL
		, 'CLOSING_TYPE=' || chr(36) || '{CF_CLOSING_TYPE};CLOSING_DATE=' || chr(36) || '{CF_CLOSING_DATE};SCENARIO_TYPE=' || chr(36) || '{CF_SCENARIO_TYPE};RUN_TYPE=' || chr(36) || '{CF_RUN_TYPE};CLOSING_PERIOD=' || chr(36) || '{CF_CLOSING_PERIOD};');

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_04, 'Extract Coverage Unit/Risk drivers for SAS', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_05, 'Extract RA Factors for SAS', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_06, 'Extract Retro Linkage for SAS', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, JOB_PARAMS)
        VALUES ( VAR_JOB_ID_07, 'Extract GL Accounts for SAS', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, NULL);

SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_01, 'Assumed Treaty Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_TRT_CHARACS(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{TRT_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_01, 'Assumed Treaty - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, chr(36) || '{DWH_DB}', 'TCSM_TRT_CHARACS', '~', true, 'SELECT * FROM ' || chr(36) || '{DWH_DB}.TCSM_TRT_CHARACS WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{TRT_CLOSING_TYPE}'' AND INTERVAL =''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_TRT_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_01, 'Assumed Treaty - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_TRT_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');


SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_02, 'Quotes Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_QUOTES(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{QT_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_02, 'Quotes - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, chr(36) || '{DWH_DB}', 'TCSM_QUOTES', '~', true, 'SELECT * FROM ' || chr(36) || '{DWH_DB}.TCSM_QUOTES WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID   = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{QT_CLOSING_TYPE}'' AND INTERVAL =''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_QT_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_02, 'Quotes - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_QT_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');

SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE, IS_ACTIVE, PRE_STEP_PROCESSING, STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_03, 'Cashflow Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_PROJECTED_CASHFLOW_DTM(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{CF_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE, IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_03, 'Cashflow - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, '~', true, 'SELECT ROW_NUMBER() OVER() AS ROW_ID, REPORTING_DT, SCENARIO_ID, ENTITY_ID, INSURANCE_CONTRACT_GROUP_ID, CASHFLOW_LEG_NM, CEDED_FLG, CASHFLOW_TYPE_CD, CURRENCY_CD, INCURRED_CLAIM_DT, CASHFLOW_DT, CASHFLOW_AMT, NORM_CD, DATA_TYPE, RUN_ID, "INTERVAL", ASOFDAY, AOC_RULE_CD  FROM ' || chr(36) || '{DWH_DB}.TCSM_PROJECTED_CASHFLOW_DTM WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID   = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{CF_CLOSING_TYPE}'' AND INTERVAL = ''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_CF_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE, IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_03, 'Cashflow - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_CF_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');




SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_04, 'Coverage Unit/Risk drivers Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_IR_DRIVER_DTM(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{CU_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_04, 'Coverage Unit/Risk drivers - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, '~', true, 'SELECT ROW_NUMBER() OVER() AS ROW_ID, REPORTING_DT, SCENARIO_ID, ENTITY_ID, INSURANCE_CONTRACT_GROUP_ID, RISK_DRIVER_NM, CEDED_FLG, CURRENCY_CD, PROJECTION_DT, RISK_DRIVER_AMT, NORM_CD, RUN_ID, "INTERVAL", ASOFDAY, AOC_RULE_CD FROM ' || chr(36) || '{DWH_DB}.TCSM_IR_DRIVER_DTM WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID   = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{CU_CLOSING_TYPE}'' AND INTERVAL = ''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_CU_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_04, 'Coverage Unit/Risk drivers - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_CU_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');


SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_05, 'RA Factors Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_RISK_FACTORS(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{RA_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_05, 'RA Factors - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, '~', true, 'SELECT ROW_NUMBER() OVER() AS ROW_ID, REPORTING_DT, SCENARIO_ID, ENTITY_ID, INSURANCE_CONTRACT_GROUP_ID, CASHFLOW_LEG_NM, CASHFLOW_TYPE_CD, CASHFLOW_DT, RISK_FACTOR_RT, NORM_CD, DATA_TYPE, RUN_ID, "INTERVAL", ASOFDAY FROM ' || chr(36) || '{DWH_DB}.TCSM_RA_RISK_FACTORS WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{RA_CLOSING_TYPE}'' AND INTERVAL = ''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID'
		, 'csm/out', chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_RA_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_05, 'RA Factors - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_RA_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');


SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_06, 'Retro Linkage Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_RETROLINKAGE(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_06, 'Retro Linkage - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, '~', true, 'SELECT ROW_ID, REPORTING_DT, SCENARIO_ID, ENTITY_ID, INSURANCE_CONTRACT_GROUP_ID, REL_INSURANCE_CONTRACT_GROUP_ID, ASSOCIATION_CD, WEIGHT_PCT, REINS_FIXED_RECOVER_PCT, NORM_CD, DATA_TYPE, RUN_ID, "INTERVAL", ASOFDAY FROM ' || chr(36) || '{DWH_DB}.TCSM_RETROLINKAGE WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{CLOSING_TYPE}'' AND INTERVAL = ''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_RL_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_06, 'Retro Linkage - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_RL_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');
		
SET VAR_STEP_01  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03  = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_07, 'GL Accounts Datamart - Procedeure call', 1, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, NULL, NULL, chr(36) || '{DWH_DB}.IFRS17_CSM_GL_ACCOUNT_BALANCE_DTM(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{CLOSING_DATE}'', ''' || chr(36) || '{DWH_DB}'', ''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{SCENARIO_TYPE_ID}'', ''' || chr(36) || '{SAS_ENTITY}'', ''' || chr(36) || '{GL_CLOSING_TYPE}'', ''' || chr(36) || '{DIP_RUN_ID}'', ''' || chr(36) || '{INTERVAL}'')', NULL, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_07, 'GL Accounts - Data extraction', 2, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, '~', true, 'SELECT ROW_ID, REPORTING_DT, SCENARIO_ID, ENTITY_ID, GL_ACCOUNT_ID, ACCOUNT_PERIOD_START_DT, ACCOUNT_PERIOD_END_DT, INSURANCE_CONTRACT_GROUP_ID, CASHFLOW_DT, CEDED_FLG, INCURRED_CLAIM_DT, REPORTING_METHOD_CD, ACCOUNT_PERIOD_UOM_CD, CURRENCY_CD, ACCOUNT_PERIOD_OPENING_BAL_AMT, ACCOUNT_PERIOD_CLOSING_BAL_AMT, NORM_CD, RUN_ID, ASOFDAY, AOC_RULE_CD FROM ' || chr(36) || '{DWH_DB}.TCSM_GL_ACCOUNT_BALANCE_DTM WHERE REPORTING_DT = VARCHAR_FORMAT(''' || chr(36) || '{CLOSING_DATE}'' , ''DD/MM/YYYY'') AND CLOSING_QUARTER_CODE = ''' || chr(36) || '{CLOSING_PERIOD}'' AND SCENARIO_ID = ''' || chr(36) || '{SCENARIO_TYPE_ID}'' AND ENTITY_ID = ''' || chr(36) || '{SAS_ENTITY}'' AND RUN_ID = ''' || chr(36) || '{DIP_RUN_ID}'' AND NORM_CD  = ''' || chr(36) || '{GL_CLOSING_TYPE}'' AND ACCOUNT_PERIOD_UOM_CD = ''' || chr(36) || '{INTERVAL}'' ORDER BY ROW_ID', 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_GL_' || chr(36) || '{DIP_RUN_ID}.txt', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 4, VAR_JOB_ID_07, 'GL Accounts - SFTP file to SAS', 3, NULL, NULL, 'sftp:sas-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_03, NULL, NULL, NULL, NULL, NULL, 'csm/out'
		, chr(36) || '{E}_SAS_RUNJ0001_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SCENARIO_TYPE}_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_DATE_YYYYMMDD}_GL_' || chr(36) || '{DIP_RUN_ID}.txt', 'ARCHIVE');

SET VAR_BATCH_GROUPING_ID = NEXT VALUE FOR SEQUENCE_BATCH_GROUPING;

INSERT INTO BATCH_GROUPING (BATCH_GROUPING_ID, BATCH_GROUPING_NAME, ACTIVE_DWH, PASSIVE_DWH, LAST_UPDATE_TIME)
		VALUES(VAR_BATCH_GROUPING_ID, 'DIP to SAS PROCESSING', 'DWHD2_' || chr(36) || '{ENV}', 'DWHD1_' || chr(36) || '{ENV}', CURRENT_TIMESTAMP);

INSERT INTO EVENT ( EVENT_CODE, EVENT_DESCRIPTION )
        VALUES ( 'EVT_DIP_TO_SAS_DATA', 'Event TO EXTRACT DIP to SAS data' );

INSERT INTO EVENT_MAPPING ( EVENT_CODE, BATCH_ID, ORCHESTRATION_PROCESS_STEP_ID, ORCHESTRATION_PROCESS_ID, BATCH_GROUPING_ID, IS_DWH_SWITCH)
        VALUES ( 'EVT_DIP_TO_SAS_DATA', VAR_BATCH_ID, VAR_ORCHESTRATION_PROCESS_STEP_ID_01, VAR_ORCHESTRATION_PROCESS_ID, VAR_BATCH_GROUPING_ID, TRUE);

INSERT INTO EXECUTION_KEY_VALUE_METADATA ("GROUP", "KEY", VALUE)
	VALUES('SERVICE_FILE_NAMES', 'EVT_DIP_TO_SAS_DATA' , chr(36) || '{E}_INREQECH01_DIP_' || chr(36) || '{SAS_ENTITY}_' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{DATE_YYYYMMDD}_' || chr(36) || '{DIP_RUN_ID}_SERVICE.json');

INSERT INTO EXECUTION_KEY_VALUE_METADATA ("GROUP", "KEY", VALUE)
	VALUES('SYSTEM', 'EVT_DIP_TO_SAS_DATA', 'sas');


SET VAR_ORCHESTRATION_PROCESS_STEP_ID_02 = NEXT VALUE FOR SEQUENCE_ORCHESTRATION_PROCESS_METADATA;
SET VAR_BATCH_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_GROUP_ID_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_GROUP_ID_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_03 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_04 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_05 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO ORCHESTRATION_PROCESS_STEP (ORCHESTRATION_PROCESS_STEP_ID,ORCHESTRATION_PROCESS_ID,ORCHESTRATION_PROCESS_STEP_NAME,CHILD_BATCH_ID,TRIGGER_DEPENDENT_STEPS, STARTING_STEP, OPTIONAL_RUN) VALUES
(VAR_ORCHESTRATION_PROCESS_STEP_ID_02, VAR_ORCHESTRATION_PROCESS_ID,'Orchestration Process Step for SAS to DIP', VAR_BATCH_ID, NULL, false, false);

INSERT INTO ORCHESTRATION_PROCESS_STEP_DEPENDENCY(ORCHESTRATION_PROCESS_STEP_ID, PARENT_ORCHESTRATION_PROCESS_STEP_ID)
VALUES (VAR_ORCHESTRATION_PROCESS_STEP_ID_02, VAR_ORCHESTRATION_PROCESS_STEP_ID_01);

INSERT INTO BATCH (BATCH_ID,BATCH_NAME,BATCH_DESCRIPTION,APPLICATION_NAME,BATCH_PRIORITY,ON_ERROR,PRE_BATCH_PROCESSING,POST_BATCH_PROCESSING) VALUES
	(VAR_BATCH_ID,'SAS to DIP Run','SAS extract DIP','DIP', 1, NULL, 'api-dip:uploadinsert', 'api-dip:postSasResultsProcessing');

INSERT INTO JOB_GROUP (JOB_GROUP_ID,JOB_GROUP_NAME,BATCH_ID,PARENT_JOB_GROUP_ID) VALUES
	(VAR_JOB_GROUP_ID_01, 'Extract Data from SAS Job Group', VAR_BATCH_ID, NULL);

INSERT INTO JOB_GROUP (JOB_GROUP_ID,JOB_GROUP_NAME,BATCH_ID,PARENT_JOB_GROUP_ID) VALUES
	(VAR_JOB_GROUP_ID_02, 'Process Data from SAS Job Group', VAR_BATCH_ID, VAR_JOB_GROUP_ID_01);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE, EXECUTION_TYPE)
        VALUES ( VAR_JOB_ID_01, 'Extract SAS Results (AE) to DIP', NULL, VAR_JOB_GROUP_ID_01, NULL, NULL, 'MULTI', 'PARALLEL');
INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE, EXECUTION_TYPE)
        VALUES ( VAR_JOB_ID_05, 'Extract SAS Results (PROFITABILITY) to DIP', NULL, VAR_JOB_GROUP_ID_01, NULL, TRUE, 'MULTI', 'PARALLEL');

SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 1, VAR_JOB_ID_01, 'AE Data fetch step', 1, NULL, NULL, 'sftp:sas-from', NULL);
INSERT INTO DATA_FETCH_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, FILE_DIRECTORY, FILE_NAME_PATTERN, REGIONAL_DATA, FETCH_TYPE
, FEEDER_SYSTEM_DB_SERVER, FEEDER_DB_NAME, FEEDER_SCHEMA_NAME, FEEDER_TABLE_NAME, SPECIFIC_PROCESS, FEEDER_FILE_DIRECTORY, FEEDER_FILE_NAME_PATTERN)
	VALUES(VAR_STEP_01, NULL, NULL, 'csm/in'
	, chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat'
	, false, 'FILE_FETCH', NULL, NULL, NULL, NULL, NULL, '/csm/out'
	, chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat');

SELECT DATA_VALIDATION_CONTROL_ID INTO VAR_DATA_VALIDATION_CONTROL_ID FROM DATA_VALIDATION_CONTROL WHERE CONTROL_NAME = 'Verify MD5 Hash Control';

IF VAR_DATA_VALIDATION_CONTROL_ID IS NULL THEN 
	SET VAR_DATA_VALIDATION_CONTROL_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

	INSERT INTO DATA_VALIDATION_CONTROL (DATA_VALIDATION_CONTROL_ID, CONTROL_NAME, CONTROL_PROCESSING, SPECIFIC_PROCESS) 
		VALUES(VAR_DATA_VALIDATION_CONTROL_ID, 'Verify MD5 Hash Control', 'api-dip:verifyMd5Hash', NULL);
END IF;


SET VAR_DATA_VALIDATION_CONTROL_MAPPING_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO DATA_VALIDATION_CONTROL_MAPPING (DATA_VALIDATION_CONTROL_MAPPING_ID, BATCH_ID, JOB_GROUP_ID, JOB_ID, STEP_ID
, DATA_VALIDATION_CONTROL_ID, IS_ACTIVE, CONTROL_TYPE, CONTROL_CHRONOLOGY, CONTROL_SEQUENCE, PARAMETER_NAMES) 
	VALUES(VAR_DATA_VALIDATION_CONTROL_MAPPING_ID, VAR_BATCH_ID, VAR_JOB_GROUP_ID_01, VAR_JOB_ID_01, VAR_STEP_01
	, VAR_DATA_VALIDATION_CONTROL_ID, TRUE, 'INFO', 'POST-POST', 1, NULL);

SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 1, VAR_JOB_ID_05, 'PROFITABILITY Data fetch step ', 1, NULL, NULL, 'sftp:sas-from', NULL);
INSERT INTO DATA_FETCH_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, FILE_DIRECTORY, FILE_NAME_PATTERN, REGIONAL_DATA, FETCH_TYPE
, FEEDER_SYSTEM_DB_SERVER, FEEDER_DB_NAME, FEEDER_SCHEMA_NAME, FEEDER_TABLE_NAME, SPECIFIC_PROCESS, FEEDER_FILE_DIRECTORY, FEEDER_FILE_NAME_PATTERN)
	VALUES(VAR_STEP_01, NULL, NULL, 'csm/in'
	, chr(36) || '{E}_ESFD3860_PA' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SSD_PF}_' || chr(36) || '{ESB_PF}_' || chr(36) || '{TIMESTAMP}_CSMENGINE.dat'
	, false, 'FILE_FETCH', NULL, NULL, NULL, NULL, NULL, '/csm/out'
	, chr(36) || '{E}_ESFD3860_PA' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SSD_PF}_' || chr(36) || '{ESB_PF}_' || chr(36) || '{TIMESTAMP}_CSMENGINE.dat');

SET VAR_DATA_VALIDATION_CONTROL_MAPPING_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO DATA_VALIDATION_CONTROL_MAPPING (DATA_VALIDATION_CONTROL_MAPPING_ID, BATCH_ID, JOB_GROUP_ID, JOB_ID, STEP_ID
, DATA_VALIDATION_CONTROL_ID, IS_ACTIVE, CONTROL_TYPE, CONTROL_CHRONOLOGY, CONTROL_SEQUENCE, PARAMETER_NAMES) 
	VALUES(VAR_DATA_VALIDATION_CONTROL_MAPPING_ID, VAR_BATCH_ID, VAR_JOB_GROUP_ID_01, VAR_JOB_ID_05, VAR_STEP_01
	, VAR_DATA_VALIDATION_CONTROL_ID, TRUE, 'INFO', 'POST-POST', 1, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE)
        VALUES ( VAR_JOB_ID_02, 'Process AE from SAS to DIP', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, 'MULTI');
INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE)
        VALUES ( VAR_JOB_ID_03, 'Truncate Profitability Staging Table', NULL, VAR_JOB_GROUP_ID_02, NULL, TRUE, NULL );
INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE)
        VALUES ( VAR_JOB_ID_04, 'Process Profitability from SAS to DIP', NULL, VAR_JOB_GROUP_ID_02, NULL, TRUE, 'MULTI');

INSERT INTO JOB_DEPENDENCY (JOB_ID, PARENT_JOB_ID)
		VALUES(VAR_JOB_ID_04, VAR_JOB_ID_03);

SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_03 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_04 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_05 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_06 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;


INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 2, VAR_JOB_ID_02, 'AE Staging load step', 1, NULL, NULL, 'binary-dip:dbload-file', NULL);
INSERT INTO STAGING_LOAD_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, TRUNCATE_STAGING_TABLE, MANDATORY_FILE, FILE_HEADER_ROWS, DELIMITER
, CONVERTED_STAGING_TABLE_NAME, CHECK_DUPLICATES, SPECIFIC_PROCESS, DATA_FILE_TREATMENT, REGIONAL_DATA, FILE_DIRECTORY, FILE_NAME_PATTERN)
		VALUES(VAR_STEP_02, 'STAGING_' || chr(36) || '{ENV}', 'TCSM_STAGING_MICRO_AOC', TRUE, TRUE, 1, '~'
		, NULL, false, NULL, 'ARCHIVE', false, 'csm/in'
		, chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat');

SELECT DATA_VALIDATION_CONTROL_ID INTO VAR_DATA_VALIDATION_CONTROL_ID FROM DATA_VALIDATION_CONTROL WHERE CONTROL_NAME = 'SAS AE Results Amount Control';

IF VAR_DATA_VALIDATION_CONTROL_ID IS NULL THEN 
	SET VAR_DATA_VALIDATION_CONTROL_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

	INSERT INTO DATA_VALIDATION_CONTROL (DATA_VALIDATION_CONTROL_ID, CONTROL_NAME, CONTROL_PROCESSING, SPECIFIC_PROCESS) 
		VALUES(VAR_DATA_VALIDATION_CONTROL_ID, 'SAS AE Results Amount Control', 'api-dip:sasAEAmountTrace', NULL);
END IF;


SET VAR_DATA_VALIDATION_CONTROL_MAPPING_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO DATA_VALIDATION_CONTROL_MAPPING (DATA_VALIDATION_CONTROL_MAPPING_ID, BATCH_ID, JOB_GROUP_ID, JOB_ID, STEP_ID
, DATA_VALIDATION_CONTROL_ID, IS_ACTIVE, CONTROL_TYPE, CONTROL_CHRONOLOGY, CONTROL_SEQUENCE, PARAMETER_NAMES) 
	VALUES(VAR_DATA_VALIDATION_CONTROL_MAPPING_ID, VAR_BATCH_ID, VAR_JOB_GROUP_ID_02, VAR_JOB_ID_02, VAR_STEP_02
	, VAR_DATA_VALIDATION_CONTROL_ID, TRUE, 'INFO', 'POST-POST', 1, NULL);


INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_03, 2, VAR_JOB_ID_02, 'AE Staging Processing for DIP step', 2, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO STAGING_LOAD_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, TRUNCATE_STAGING_TABLE, MANDATORY_FILE, FILE_HEADER_ROWS, DELIMITER
, CONVERTED_STAGING_TABLE_NAME, CHECK_DUPLICATES, SPECIFIC_PROCESS, DATA_FILE_TREATMENT, REGIONAL_DATA, FILE_DIRECTORY, FILE_NAME_PATTERN)
		VALUES(VAR_STEP_03, NULL, NULL, false, false, NULL, NULL, NULL, false
		, 'STAGING_' || chr(36) || '{ENV}.SP_LOAD_SAS_TCSM_MICRO_AOC(''' || chr(36) || '{UPLOAD_REQUEST_ID}'', ''' || chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat'', ''' || chr(36) || '{AS_OF_DATE}'', ''STAGING_' || chr(36) || '{ENV}'', ''' || chr(36) || '{DWH_DB}'',''BI_' || chr(36) || '{ENV}'', ''' || chr(36) || '{JOB_INSTANCE_ID}'')'
		, NULL, false, NULL, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_04, 2, VAR_JOB_ID_02, 'AE Staging Processing for Omega step', 3, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO STAGING_LOAD_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, TRUNCATE_STAGING_TABLE, MANDATORY_FILE, FILE_HEADER_ROWS, DELIMITER
, CONVERTED_STAGING_TABLE_NAME, CHECK_DUPLICATES, SPECIFIC_PROCESS, DATA_FILE_TREATMENT, REGIONAL_DATA, FILE_DIRECTORY, FILE_NAME_PATTERN)
		VALUES(VAR_STEP_04, NULL, NULL, false, false, NULL, NULL, NULL, false
		, 'STAGING_' || chr(36) || '{ENV}.SP_LOAD_WRK_TCSM_MACRO_AOC_TO_OMEGA(''' || chr(36) || '{CLOSING_PERIOD}'', ''' || chr(36) || '{AS_OF_DATE}'', ''STAGING_' || chr(36) || '{ENV}'', ''' || chr(36) || '{DWH_DB}'',''BI_' || chr(36) || '{ENV}'')'
		, NULL, false, NULL, NULL);
		

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING, STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_05, 3, VAR_JOB_ID_02, 'Omega AE Historization Step', 4, NULL, NULL, 'db-dip:sp-explicit', NULL);
INSERT INTO DWH_LOAD_STEP (STEP_ID, DWH_SCHEMA_NAME, DWH_TABLE_NAME, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, INGESTION_MODE, HISTORIZATION_TYPE
, SPECIFIC_PROCESS)
		VALUES(VAR_STEP_05, NULL, NULL, NULL, NULL, NULL, NULL
		, chr(36) || '{DWH_DB}.GP_HISTORIZATION(''' || chr(36) || '{UPLOAD_REQUEST_ID}'', ''INCREMENTAL'',''STAGING_' || chr(36) || '{ENV}'', ''WRK_TCSM_MACRO_AOC_TO_OMEGA'', ''' || chr(36) || '{DWH_DB}'', ''DWH_TCSM_MACRO_AOC_TO_OMEGA'', ''DELIVERY_' || chr(36) || '{ENV}'', ''CONF_TABLE_KEY'', FALSE)');

SELECT DATA_VALIDATION_CONTROL_ID INTO VAR_DATA_VALIDATION_CONTROL_ID FROM DATA_VALIDATION_CONTROL WHERE CONTROL_NAME = 'Omega AE Results Amount Control';

IF VAR_DATA_VALIDATION_CONTROL_ID IS NULL THEN 
	SET VAR_DATA_VALIDATION_CONTROL_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

	INSERT INTO DATA_VALIDATION_CONTROL (DATA_VALIDATION_CONTROL_ID, CONTROL_NAME, CONTROL_PROCESSING, SPECIFIC_PROCESS) 
		VALUES(VAR_DATA_VALIDATION_CONTROL_ID, 'Omega AE Results Amount Control', 'api-dip:omegaAEAmountTrace', NULL);
END IF;


SET VAR_DATA_VALIDATION_CONTROL_MAPPING_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO DATA_VALIDATION_CONTROL_MAPPING (DATA_VALIDATION_CONTROL_MAPPING_ID, BATCH_ID, JOB_GROUP_ID, JOB_ID, STEP_ID
, DATA_VALIDATION_CONTROL_ID, IS_ACTIVE, CONTROL_TYPE, CONTROL_CHRONOLOGY, CONTROL_SEQUENCE, PARAMETER_NAMES) 
	VALUES(VAR_DATA_VALIDATION_CONTROL_MAPPING_ID, VAR_BATCH_ID, VAR_JOB_GROUP_ID_02, VAR_JOB_ID_02, VAR_STEP_05
	, VAR_DATA_VALIDATION_CONTROL_ID, TRUE, 'INFO', 'POST-POST', 1, NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_06, 4, VAR_JOB_ID_02, 'Omega AE - Data extraction', 5, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_06, NULL, NULL, '~', FALSE, 'SELECT SSD_CF, ESB_CF, NUMLINE_NT, BALSHEY_NF, BALSHRMTH_NF, BALSHRDAY_NF, VALPERY_NF, VALPERMTH_NF, TRNCOD_CF, RETAUTGEN_B, CTR_NF, END_NT, SEC_NF, UWY_NF, UW_NT, OCCYEA_NF, ACY_NF, SCOSTRMTH_NF, SCOENDMTH_NF, CLM_NF, CUR_CF, AMT_M, RETCTR_NF, RETEND_NT, RETSEC_NF, RTY_NF, RETUW_NT, PLC_NT, RETOCCYEA_NF, RETACY_NF, RETSCOSTRMTH_NF, RETSCOENDMTH_NF, RCL_NF, RETCUR_CF,RETAMT_M, COMMAC_LL, SPEENTTYP_CF, SPEENTNAT_CT, EVT_NT, REVT_NT FROM STAGING_' || chr(36) || '{ENV}.WRK_TCSM_MACRO_AOC_TO_OMEGA ORDER BY NUMLINE_NT', 'omega/out'
		, chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat', NULL);


SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 2, VAR_JOB_ID_03, 'Truncate Profitability Staging Table', 1, NULL, NULL, NULL, NULL);
INSERT INTO STAGING_LOAD_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, TRUNCATE_STAGING_TABLE, MANDATORY_FILE, FILE_HEADER_ROWS, DELIMITER
, CONVERTED_STAGING_TABLE_NAME, CHECK_DUPLICATES, SPECIFIC_PROCESS, DATA_FILE_TREATMENT, REGIONAL_DATA, FILE_DIRECTORY, FILE_NAME_PATTERN)
		VALUES(VAR_STEP_01, 'STAGING_' || chr(36) || '{ENV}', 'TCSM_PROFITABILITY', true, NULL, NULL, NULL
		, NULL, false, NULL, NULL, false, NULL, NULL);

SET VAR_STEP_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 2, VAR_JOB_ID_04, 'PROFITABILITY Stagging load step', 1, NULL, NULL, 'binary-dip:dbload-file', NULL);
INSERT INTO STAGING_LOAD_STEP (STEP_ID, STAGING_SCHEMA_NAME, STAGING_TABLE_NAME, TRUNCATE_STAGING_TABLE, MANDATORY_FILE, FILE_HEADER_ROWS, DELIMITER
, CONVERTED_STAGING_TABLE_NAME, CHECK_DUPLICATES, SPECIFIC_PROCESS, DATA_FILE_TREATMENT, REGIONAL_DATA, FILE_DIRECTORY, FILE_NAME_PATTERN)
		VALUES(VAR_STEP_02, 'STAGING_' || chr(36) || '{ENV}', 'TCSM_PROFITABILITY', false, true, NULL, '~'
		, NULL, false, NULL, 'ARCHIVE', false, 'csm/in'
		, chr(36) || '{E}_ESFD3860_PA' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SSD_PF}_' || chr(36) || '{ESB_PF}_' || chr(36) || '{TIMESTAMP}_CSMENGINE.dat');


SELECT BATCH_GROUPING_ID INTO VAR_BATCH_GROUPING1_ID FROM BATCH_GROUPING WHERE BATCH_GROUPING_NAME = 'SAS to DIP PROCESSING';

IF VAR_BATCH_GROUPING1_ID IS NULL THEN 
	SET VAR_BATCH_GROUPING1_ID = NEXT VALUE FOR SEQUENCE_BATCH_GROUPING;

	INSERT INTO BATCH_GROUPING (BATCH_GROUPING_ID, BATCH_GROUPING_NAME, ACTIVE_DWH, PASSIVE_DWH, LAST_UPDATE_TIME)
		VALUES(VAR_BATCH_GROUPING1_ID, 'SAS to DIP PROCESSING', 'DWHD2_' || chr(36) || '{ENV}', 'DWHD1_' || chr(36) || '{ENV}', CURRENT_TIMESTAMP);

END IF;

INSERT INTO EVENT ( EVENT_CODE, EVENT_DESCRIPTION )
        VALUES ( 'EVT_SAS_TO_DIP_RESULTS', 'Event TO EXTRACT SAS to DIP data' );

INSERT INTO EVENT_MAPPING ( EVENT_CODE, BATCH_ID, ORCHESTRATION_PROCESS_STEP_ID, ORCHESTRATION_PROCESS_ID, BATCH_GROUPING_ID, IS_DWH_SWITCH)
        VALUES ( 'EVT_SAS_TO_DIP_RESULTS', VAR_BATCH_ID, VAR_ORCHESTRATION_PROCESS_STEP_ID_02, NULL, VAR_BATCH_GROUPING1_ID, TRUE);

SET VAR_BATCH_ID = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_GROUP_ID_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_03 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_JOB_ID_04 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO BATCH (BATCH_ID,BATCH_NAME,BATCH_DESCRIPTION,APPLICATION_NAME,BATCH_PRIORITY,ON_ERROR,PRE_BATCH_PROCESSING,POST_BATCH_PROCESSING) VALUES
	(VAR_BATCH_ID,'DIP to Omega Run (SAS Results)','DIP to Omega Run (SAS Results)','DIP', 1, NULL, NULL, NULL);

INSERT INTO JOB_GROUP (JOB_GROUP_ID,JOB_GROUP_NAME,BATCH_ID,PARENT_JOB_GROUP_ID) VALUES
	(VAR_JOB_GROUP_ID_02, 'Provide SAS Data to Omega Job Group', VAR_BATCH_ID, NULL);

INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE, EXECUTION_TYPE)
        VALUES ( VAR_JOB_ID_03, 'Provide AE from DIP to Omega', NULL, VAR_JOB_GROUP_ID_02, NULL, NULL, 'MULTI', 'PARALLEL' );
INSERT INTO JOB ( JOB_ID, JOB_NAME, JOB_PRIORITY, JOB_GROUP_ID, IS_ACTIVE, JOB_OPTIONAL_RUN, INSTANCE_TYPE, EXECUTION_TYPE)
        VALUES ( VAR_JOB_ID_04, 'Provide Profitability from DIP to Omega', NULL, VAR_JOB_GROUP_ID_02, NULL, TRUE, 'MULTI', 'PARALLEL' );


SET VAR_STEP_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_03, 'AE - SFTP file to Omega', 1, NULL, NULL, 'sftp:omega-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, NULL, NULL, chr(36) || '{BATCHUSER_CF_AE}', 'omega/out'
		, chr(36) || '{E}_ESIJ0790_AE_' || chr(36) || '{SSD_AE}_' || chr(36) || '{ESB_AE}_CSMENGINE_' || chr(36) || '{TIMESTAMP}.dat', 'ARCHIVE');


SET VAR_STEP_01 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;
SET VAR_STEP_02 = NEXT VALUE FOR SEQUENCE_BATCH_METADATA;

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_01, 4, VAR_JOB_ID_04, 'PFT - Data extraction', 1, NULL, NULL, 'binary-dip:dbsql-query-explicit', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_01, NULL, NULL, '~', FALSE
		, 'SELECT * FROM STAGING_' || chr(36) || '{ENV}.TCSM_PROFITABILITY WHERE SSD_CF = ''' || chr(36) || '{SSD_PF}'' and ESB_CF = ''' || chr(36) || '{ESB_PF}'' ORDER BY NUMLINE_NT', 'omega/out'
		, chr(36) || '{E}_ESFD3860_PA' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SSD_PF}_' || chr(36) || '{ESB_PF}_' || chr(36) || '{TIMESTAMP_HHMMSS}_CSMENGINE.dat', NULL);

INSERT INTO STEP ( STEP_ID, STEP_TYPE_ID, JOB_ID, STEP_NAME, STEP_SEQUENCE ,IS_ACTIVE, PRE_STEP_PROCESSING,STEP_PROCESSING, POST_STEP_PROCESSING)
        VALUES ( VAR_STEP_02, 4, VAR_JOB_ID_04, 'PFT - SFTP file to Omega', 2, NULL, NULL, 'sftp:omega-to', NULL);
INSERT INTO DATA_EXPOSITION_STEP (STEP_ID, SCHEMA_NAME, TABLE_NAME, DELIMITER, INCLUDE_HEADER, SPECIFIC_PROCESS, FILE_DIRECTORY, FILE_NAME_PATTERN, DATA_FILE_TREATMENT)
		VALUES(VAR_STEP_02, NULL, NULL, NULL, NULL, chr(36) || '{BATCHUSER_CF_PF}', 'omega/out'
		, chr(36) || '{E}_ESFD3860_PA' || chr(36) || '{CLOSING_TYPE}_' || chr(36) || '{SSD_PF}_' || chr(36) || '{ESB_PF}_' || chr(36) || '{TIMESTAMP_HHMMSS}_CSMENGINE.dat', 'ARCHIVE');
		

INSERT INTO EVENT ( EVENT_CODE, EVENT_DESCRIPTION )
        VALUES ( 'EVT_DIP_TO_OMEGA_RUN_FOR_SAS_RESULTS', 'Event to Extract SAS Results from DIP for Omega' );

INSERT INTO EVENT_MAPPING ( EVENT_CODE, BATCH_ID, ORCHESTRATION_PROCESS_STEP_ID, ORCHESTRATION_PROCESS_ID, BATCH_GROUPING_ID, IS_DWH_SWITCH)
        VALUES ( 'EVT_DIP_TO_OMEGA_RUN_FOR_SAS_RESULTS', VAR_BATCH_ID, NULL, NULL, VAR_BATCH_GROUPING1_ID, FALSE);

EXCEPTION WHEN OTHERS THEN 
	L_ERR_CD := SUBSTR(SQLERRM, 8, 5); 
	L_ERR_MSG := SQLERRM; 
	RAISE EXCEPTION '% Error while executing SQL statement', L_ERR_MSG; 
	RETURN L_ERR_CD; 
 
END; 

END_PROC;