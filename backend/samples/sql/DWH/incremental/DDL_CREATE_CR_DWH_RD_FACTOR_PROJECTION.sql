DROP TABLE DWH_RD_FACTOR_PROJECTION IF EXISTS;

CREATE TABLE DWH_RD_FACTOR_PROJECTION (
   CONTRACT_NUMBER      CHAR(9)               
      NOT NULL,
   SECTION_NUMBER       SMALLINT              
      NOT NULL,
   UNDERWRITING_YEAR    SMALLINT              
      NOT NULL DEFAULT 0,
   CALCULATED_POSITION_ID INTEGER               
      NOT NULL,
   LEVEL_OF_ANALYSIS_ID INTEGER               
      NOT NULL,
   REPORTING_BASIS_ID   SMALLINT,
   CLOSING_DATE         DATE                  
      NOT NULL,
   ASSUMED_CONTRACT_NUMBER CHAR(9),
   ASSUMED_SECTION_NUMBER SMALLINT,
   PROJECTION_YEAR      SMALLINT              
      NOT NULL,
   PROJECTION_PERIOD    SMALLINT              
      NOT NULL,
   PERIOD_TYPE_ID       SMALLINT,
   IS_PRESENT_VALUE     BOOLEAN,
   FACTOR               DECFLOAT              
      NOT NULL,
   HASH_KEY             VARBINARY(64)         
      NOT NULL,
   VALID_FROM           TIMESTAMP             
      NOT NULL,
   VALID_TO             TIMESTAMP             
      NOT NULL,
   PIVOT_KEY            VARBINARY(64),
   SUPP_DATE            TIMESTAMP,
   CREATED_REQUEST_ID   BIGINT,
   MODIFIED_REQUEST_ID  BIGINT,
   DELETED_REQUEST_ID   BIGINT,
   CONSTRAINT PK_DWH_RD_FACTOR_PROJECTION PRIMARY KEY (HASH_KEY, 
VALID_FROM)  
)
 in TBS_<env>  DISTRIBUTE BY hash(HASH_KEY);

COMMENT ON TABLE DWH_RD_FACTOR_PROJECTION IS
'Risk Driver Group for each Contract Section';

COMMENT ON COLUMN DWH_RD_FACTOR_PROJECTION.CONTRACT_NUMBER IS
'Contract number';

COMMENT ON COLUMN DWH_RD_FACTOR_PROJECTION.SECTION_NUMBER IS
'Section number';

COMMENT ON COLUMN DWH_RD_FACTOR_PROJECTION.UNDERWRITING_YEAR IS
'Underwriting Year of the contract';

ALTER TABLE DWH_RD_FACTOR_PROJECTION
   ADD CONSTRAINT FK_RD_FACTOR_PROJECTION_BY_LOA FOREIGN KEY 
(LEVEL_OF_ANALYSIS_ID)
      REFERENCES DWH_LEVEL_OF_ANALYSIS (ID)
      ON DELETE RESTRICT
      NOT ENFORCED;

ALTER TABLE DWH_RD_FACTOR_PROJECTION
   ADD CONSTRAINT FK_RD_FACTOR_PROJECTION_PERIOD_TYPE FOREIGN KEY 
(PERIOD_TYPE_ID)
      REFERENCES DWH_PERIOD_TYPE (ID)
      ON DELETE RESTRICT
      NOT ENFORCED;

ALTER TABLE DWH_RD_FACTOR_PROJECTION
   ADD CONSTRAINT FK_RD_FACTOR_PROJECTION_POSITION FOREIGN KEY 
(CALCULATED_POSITION_ID)
      REFERENCES DWH_POSITION (ID)
      ON DELETE RESTRICT
      NOT ENFORCED;
