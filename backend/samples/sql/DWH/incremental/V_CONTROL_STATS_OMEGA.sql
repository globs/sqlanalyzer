CREATE OR REPLACE
VIEW V_CONTROL_STATS_OMEGA (SSD_CF,
ESB_CF,
TRT_STAT_NAME,
TRT_STAT_VALUE,
TRT_SEC_STAT_NAME,
TRT_SEC_STAT_VALUE,
BALSHRMTH_NF,
BALSHEY_NF) AS (

SELECT
	SSD_CF,
	ESB_CF,
	'TRT_OMEGA' AS TRT_STAT_NAME,
	COUNT(DISTINCT CTR_NF) AS TRT_STAT_VALUE,
	'TRT_SEC_OMEGA' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT CTR_NF || '_' || SEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHEY_NF,
	BALSHRMTH_NF
FROM
	BI_<env>.TFULLGLT
WHERE
	CTR_NF IS NOT NULL
	AND LOBACC_CF IN ('30','31')
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHEY_NF,
	BALSHRMTH_NF
	
UNION

SELECT
	SSD_CF,
	ESB_CF,
	'RET_TRT_OMEGA' AS TRT_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF) AS TRT_STAT_VALUE,
	'RET_TRT_SEC_OMEGA' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF || '_' || RETSEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHEY_NF,
	BALSHRMTH_NF
FROM
	BI_<env>.TFULLGLT
WHERE
	CTR_NF IS NULL
	AND LOBRET_CF IN ('30','31')
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHEY_NF,
	BALSHRMTH_NF

);