DROP TABLE DWH_POSITION IF EXISTS;

CREATE TABLE DWH_POSITION (
   ID                   INTEGER               
      NOT NULL,
   POSITION_TYPE_ID     SMALLINT              
      NOT NULL,
   CODE                 VARCHAR(50)           
      NOT NULL,
   NAME                 VARCHAR(100)          
      NOT NULL,
   VALID_FROM           TIMESTAMP             
      NOT NULL,
   VALID_TO             TIMESTAMP             
      NOT NULL,
   IS_CASH_FLOW         BOOLEAN,
   SIGN_CONVENTION      SMALLINT               DEFAULT 1,
   RETRO_FACTOR         SMALLINT               DEFAULT 1,
   IS_LOCAL             BOOLEAN,
   IS_IPDS              BOOLEAN,
   IS_CSM               BOOLEAN,
   IS_COMPOSITE         BOOLEAN,
   IS_DELTA             BOOLEAN,
   SORT_ORDER           SMALLINT,
   CSM_POSITION_TYPE_ID SMALLINT,
   CURRENCY_CODE        CHAR(3),
   CONSTRAINT PK_DWH_POSITION PRIMARY KEY (ID),
   CONSTRAINT CK_DWH_POSITION UNIQUE (POSITION_TYPE_ID, CODE, 
VALID_FROM)  
)
 ORGANIZE BY COLUMN IN TBS_<env> DISTRIBUTE ON RANDOM;

COMMENT ON TABLE DWH_POSITION IS
'Position ( see domain) ';

COMMENT ON COLUMN DWH_POSITION.SIGN_CONVENTION IS
'Sign could be -1 or 1';

COMMENT ON COLUMN DWH_POSITION.RETRO_FACTOR IS
'Sign could be -1 or 1';

COMMENT ON COLUMN DWH_POSITION.CURRENCY_CODE IS
'ISO 4217 currency code';

ALTER TABLE DWH_POSITION
   ADD CONSTRAINT FK_CSM_POSITION_TYPE FOREIGN KEY 
(CSM_POSITION_TYPE_ID)
      REFERENCES DWH_CSM_POSITION_TYPE (ID)
      ON DELETE RESTRICT
      NOT ENFORCED;

ALTER TABLE DWH_POSITION
   ADD CONSTRAINT FK_POSITION_TYPE FOREIGN KEY (POSITION_TYPE_ID)
      REFERENCES DWH_POSITION_TYPE (ID)
      ON DELETE RESTRICT
      NOT ENFORCED;
