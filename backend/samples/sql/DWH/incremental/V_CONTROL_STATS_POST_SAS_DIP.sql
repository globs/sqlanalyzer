CREATE OR REPLACE
VIEW V_CONTROL_STATS_POST_SAS_DIP (SSD_CF,
ESB_CF,
TRT_STAT_NAME,
TRT_STAT_VALUE,
TRT_SEC_STAT_NAME,
TRT_SEC_STAT_VALUE,
BALSHRMTH_NF,
BALSHEY_NF) AS (

SELECT
	SSD_CF,
	ESB_CF,
	'TRT_POST_SAS' AS TRT_STAT_NAME,
	COUNT(DISTINCT CTR_NF) AS TRT_STAT_VALUE,
	'TRT_SEC_POST_SAS' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT CTR_NF || '_' || SEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHRMTH_NF,
	BALSHEY_NF
FROM
	BI_<env>.TCSM_MICRO_AOC
WHERE
	CTR_NF IS NOT NULL
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHRMTH_NF,
	BALSHEY_NF
	
UNION

SELECT
	SSD_CF,
	ESB_CF,
	'RET_TRT_POST_SAS' AS TRT_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF) AS TRT_STAT_VALUE,
	'RET_TRT_SEC_POST_SAS' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF || '_' || RETSEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHRMTH_NF,
	BALSHEY_NF
FROM
	BI_<env>.TCSM_MICRO_AOC
WHERE
	CTR_NF IS NULL
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHRMTH_NF,
	BALSHEY_NF
	
UNION

SELECT
	SSD_CF,
	ESB_CF,
	'TRT_PRE_OMEGA' AS TRT_STAT_NAME,
	COUNT(DISTINCT CTR_NF) AS TRT_STAT_VALUE,
	'TRT_SEC_PRE_OMEGA' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT CTR_NF || '_' || SEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHRMTH_NF,
	BALSHEY_NF
FROM
	BI_<env>.TCSM_MACRO_AOC_TO_OMEGA
WHERE
	CTR_NF IS NOT NULL
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHRMTH_NF,
	BALSHEY_NF
	
UNION



SELECT
	SSD_CF,
	ESB_CF,
	'RET_TRT_PRE_OMEGA' AS TRT_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF) AS TRT_STAT_VALUE,
	'RET_TRT_SEC_PRE_OMEGA' AS TRT_SEC_STAT_NAME,
	COUNT(DISTINCT RETCTR_NF || '_' || RETSEC_NF) AS TRT_SEC_STAT_VALUE,
	BALSHRMTH_NF,
	BALSHEY_NF
FROM
	BI_<env>.TCSM_MACRO_AOC_TO_OMEGA
WHERE
	CTR_NF IS NULL
GROUP BY
	SSD_CF,
	ESB_CF,
	BALSHRMTH_NF,
	BALSHEY_NF
	
);