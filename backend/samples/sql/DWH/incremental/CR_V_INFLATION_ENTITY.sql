DROP VIEW V_INFLATION_ENTITY;

CREATE OR REPLACE VIEW V_INFLATION_ENTITY (
	MATURITY,
	VALIDFROM,
	VALIDTO,
	CURRENCYCODE,
	INTERESTRATE,
	ORIGINAL_CURRENCY_CODE,
	SEGMENT_CODE,
	NORM_CODE,
	PARAMETER_TYPE_ID,
	CLOSING_DATE,
	LOB_CODE,
	DISC_VALID_FROM,
	DISC_VALID_TO
) AS
SELECT
    ECONOMIC_RATE.MATURITY,
    ECONOMIC_RATE.VALID_FROM AS VALIDFROM,
    ECONOMIC_RATE.VALID_TO AS VALIDTO,
    ECONOMIC_RATE.CURRENCY_CODE AS CURRENCYCODE,
    ECONOMIC_RATE.RATE AS INTERESTRATE,
    DISCOUNT_CURRENCY_MAPPING.CURRENCY_CODE AS ORIGINAL_CURRENCY_CODE,
    ECONOMIC_RATE.SEGMENT_CODE,
    REPORTING_BASIS.CODE AS NORM_CODE,
    ECONOMIC_RATE.PARAMETER_TYPE_ID,
    ECONOMIC_RATE.CLOSING_DATE,
    ECONOMIC_RATE.LOB_CODE,
    DISCOUNT_CURRENCY_MAPPING.VALID_FROM AS DISC_VALID_FROM,
    DISCOUNT_CURRENCY_MAPPING.VALID_TO AS DISC_VALID_TO
FROM
	BI_<env>.ECONOMIC_RATE ECONOMIC_RATE
	INNER JOIN
		BI_<env>.PARAMETER_TYPE PARAMETER_TYPE
		ON ECONOMIC_RATE.PARAMETER_TYPE_ID = PARAMETER_TYPE.ID
	INNER JOIN
		BI_<env>.REPORTING_BASIS REPORTING_BASIS
		ON REPORTING_BASIS.ID = ECONOMIC_RATE.REPORTING_BASIS_ID
	INNER JOIN
		BI_<env>.DISCOUNT_CURRENCY_MAPPING DISCOUNT_CURRENCY_MAPPING
		ON DISCOUNT_CURRENCY_MAPPING.DISCOUNT_CURRENCY_CODE = ECONOMIC_RATE.CURRENCY_CODE
		AND DISCOUNT_CURRENCY_MAPPING.LOB_CODE IS NULL
WHERE
	PARAMETER_TYPE.CODE = 'INF'
	AND ECONOMIC_RATE.LOB_CODE IS NULL
UNION ALL
SELECT
    ECONOMIC_RATE.MATURITY,
    ECONOMIC_RATE.VALID_FROM AS VALIDFROM,
    ECONOMIC_RATE.VALID_TO AS VALIDTO,
    ECONOMIC_RATE.CURRENCY_CODE AS CURRENCYCODE,
    ECONOMIC_RATE.RATE AS INTERESTRATE,
    DISCOUNT_CURRENCY_MAPPING.CURRENCY_CODE AS ORIGINAL_CURRENCY_CODE,
    ECONOMIC_RATE.SEGMENT_CODE,
    REPORTING_BASIS.CODE AS NORM_CODE,
    ECONOMIC_RATE.PARAMETER_TYPE_ID,
    ECONOMIC_RATE.CLOSING_DATE,
    ECONOMIC_RATE.LOB_CODE,
    DISCOUNT_CURRENCY_MAPPING.VALID_FROM AS DISC_VALID_FROM,
    DISCOUNT_CURRENCY_MAPPING.VALID_TO AS DISC_VALID_TO
FROM
	BI_<env>.ECONOMIC_RATE ECONOMIC_RATE
	INNER JOIN
		BI_<env>.PARAMETER_TYPE PARAMETER_TYPE
		ON ECONOMIC_RATE.PARAMETER_TYPE_ID = PARAMETER_TYPE.ID
	INNER JOIN
		BI_<env>.REPORTING_BASIS REPORTING_BASIS
		ON REPORTING_BASIS.ID = ECONOMIC_RATE.REPORTING_BASIS_ID
	INNER JOIN
		BI_<env>.DISCOUNT_CURRENCY_MAPPING DISCOUNT_CURRENCY_MAPPING
		ON DISCOUNT_CURRENCY_MAPPING.DISCOUNT_CURRENCY_CODE = ECONOMIC_RATE.CURRENCY_CODE
		AND DISCOUNT_CURRENCY_MAPPING.LOB_CODE = '30'
WHERE
	PARAMETER_TYPE.CODE = 'INF'
	AND ECONOMIC_RATE.LOB_CODE = '30'
UNION ALL
SELECT
    ECONOMIC_RATE.MATURITY,
    ECONOMIC_RATE.VALID_FROM AS VALIDFROM,
    ECONOMIC_RATE.VALID_TO AS VALIDTO,
    NULL AS CURRENCYCODE,
    ECONOMIC_RATE.RATE AS INTERESTRATE,
    NULL,
    ECONOMIC_RATE.SEGMENT_CODE,
    REPORTING_BASIS.CODE AS NORM_CODE,
    ECONOMIC_RATE.PARAMETER_TYPE_ID,
    ECONOMIC_RATE.CLOSING_DATE,
    ECONOMIC_RATE.LOB_CODE,
    NULL AS DISC_VALID_FROM,
    NULL AS DISC_VALID_TO
FROM
	BI_<env>.ECONOMIC_RATE ECONOMIC_RATE
	INNER JOIN
		BI_<env>.PARAMETER_TYPE PARAMETER_TYPE
		ON ECONOMIC_RATE.PARAMETER_TYPE_ID = PARAMETER_TYPE.ID
	INNER JOIN
		BI_<env>.REPORTING_BASIS REPORTING_BASIS
		ON REPORTING_BASIS.ID = ECONOMIC_RATE.REPORTING_BASIS_ID
WHERE
	ECONOMIC_RATE.SEGMENT_CODE = 'Default'
	AND PARAMETER_TYPE.CODE = 'INF';