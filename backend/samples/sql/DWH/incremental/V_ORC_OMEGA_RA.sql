CREATE OR REPLACE
VIEW V_OMEGA_RA (
SUBSIDIARY,
SUBLEDGER,
LOB_N1,
NATURE,
NORM,
DOMAIN,
PREMIUM,
RESERVES,
CLOSING_DATE
) AS
(SELECT
   F.SUBSIDIARY_CODE as SUBSIDIARY,
   F.SUBLEDGER_CODE as SUBLEDGER,
   F.SEGMENT_CODE as LOB_N1,
   F.CONTRACT_NATURE_CODE as NATURE,
   B.CODE as NORM,
   F.DOMAIN_CODE as DOMAIN,
   DECIMAL(MAX(CASE WHEN FT.CODE = 'PREMIUM_RATE' THEN F.FACTOR END),31,8)  as PREMIUM,
   DECIMAL(MAX(CASE WHEN FT.CODE = 'RESERVING_RATE' THEN F.FACTOR END),31,8)  as RESERVES,
   F.CLOSING_DATE AS CLOSING_DATE
FROM BI_<env>.ADJUSTMENT_FACTOR F
LEFT JOIN BI_<env>.PARAMETER_TYPE PT ON
   PT.ID = F.PARAMETER_TYPE_ID
LEFT JOIN BI_<env>.ADJUSTMENT_FACTOR_TYPE FT ON
   FT.ID = F.FACTOR_TYPE_ID
LEFT JOIN BI_<env>.SEGMENT_TYPE S ON
   S.ID = F.SEGMENT_TYPE_ID
LEFT OUTER JOIN BI_<env>.REPORTING_BASIS B ON
   B.ID = F.REPORTING_BASIS_ID
WHERE  PT.CODE = 'RA'
   AND FT.CODE IN ('PREMIUM_RATE','RESERVING_RATE')
   AND F.VALID_TO = '9999-12-31'
   AND F.SUPP_DATE = '9999-12-31'
GROUP BY
   F.CLOSING_DATE,
   F.SUBSIDIARY_CODE,
   F.SUBLEDGER_CODE,
   F.SEGMENT_CODE,
   F.CONTRACT_NATURE_CODE,
   B.CODE,
   F.DOMAIN_CODE
);