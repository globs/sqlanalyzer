DROP VIEW V_YIELD_CURVE;

CREATE OR REPLACE VIEW V_YIELD_CURVE (
	VALIDFROM,
	VALIDTO,
	CURRENCYCODE,
	MATURITY,
	INTERESTRATE,
	NORM_CODE,
	ORIGINAL_CURRENCY_CODE, 
	PARAMETER_TYPE_ID,
	LOB_CODE,
	CLOSING_DATE,
	DISC_VALID_FROM,
	DISC_VALID_TO,
	SEGMENTCODE
) AS
SELECT
    ECONOMIC_RATE.VALID_FROM AS VALIDFROM,
    ECONOMIC_RATE.VALID_TO AS VALIDTO,
    ECONOMIC_RATE.CURRENCY_CODE AS CURRENCYCODE,
    ECONOMIC_RATE.MATURITY,
    ECONOMIC_RATE.RATE AS INTERESTRATE,
    REPORTING_BASIS.CODE AS NORM_CODE,
    DISCOUNT_CURRENCY_MAPPING.CURRENCY_CODE AS ORIGINAL_CURRENCY_CODE,
    ECONOMIC_RATE.PARAMETER_TYPE_ID,
    ECONOMIC_RATE.LOB_CODE,
    ECONOMIC_RATE.CLOSING_DATE,
    DISCOUNT_CURRENCY_MAPPING.VALID_FROM AS DISC_VALID_FROM,
    DISCOUNT_CURRENCY_MAPPING.VALID_TO AS DISC_VALID_TO,
    ECONOMIC_RATE.SEGMENT_CODE AS SEGMENTCODE
FROM
	BI_<env>.ECONOMIC_RATE ECONOMIC_RATE
	INNER JOIN
		BI_<env>.REPORTING_BASIS REPORTING_BASIS
		ON REPORTING_BASIS.ID = ECONOMIC_RATE.REPORTING_BASIS_ID
	INNER JOIN
		BI_<env>.PARAMETER_TYPE PARAMETER_TYPE
		ON ECONOMIC_RATE.PARAMETER_TYPE_ID = PARAMETER_TYPE.ID
	INNER JOIN
		BI_<env>.DISCOUNT_CURRENCY_MAPPING DISCOUNT_CURRENCY_MAPPING
		ON DISCOUNT_CURRENCY_MAPPING.DISCOUNT_CURRENCY_CODE = ECONOMIC_RATE.CURRENCY_CODE
		AND ECONOMIC_RATE.LOB_CODE IS NULL
WHERE
	PARAMETER_TYPE.CODE IN ('YC', 'ZCR')
	AND DISCOUNT_CURRENCY_MAPPING.LOB_CODE IS NULL
UNION ALL 
SELECT
    ECONOMIC_RATE.VALID_FROM AS VALIDFROM,
    ECONOMIC_RATE.VALID_TO AS VALIDTO,
    ECONOMIC_RATE.CURRENCY_CODE AS CURRENCYCODE,
    ECONOMIC_RATE.MATURITY,
    ECONOMIC_RATE.RATE AS INTERESTRATE,
    REPORTING_BASIS.CODE AS NORM_CODE,
    DISCOUNT_CURRENCY_MAPPING.CURRENCY_CODE AS ORIGINAL_CURRENCY_CODE,
    ECONOMIC_RATE.PARAMETER_TYPE_ID,
    ECONOMIC_RATE.LOB_CODE,
    ECONOMIC_RATE.CLOSING_DATE,
    DISCOUNT_CURRENCY_MAPPING.VALID_FROM AS DISC_VALID_FROM,
    DISCOUNT_CURRENCY_MAPPING.VALID_TO AS DISC_VALID_TO,
    ECONOMIC_RATE.SEGMENT_CODE AS SEGMENTCODE
FROM
	BI_<env>.ECONOMIC_RATE ECONOMIC_RATE
	INNER JOIN
		BI_<env>.REPORTING_BASIS REPORTING_BASIS
		ON REPORTING_BASIS.ID = ECONOMIC_RATE.REPORTING_BASIS_ID
	INNER JOIN
		BI_<env>.PARAMETER_TYPE PARAMETER_TYPE
		ON ECONOMIC_RATE.PARAMETER_TYPE_ID = PARAMETER_TYPE.ID
	INNER JOIN
		BI_<env>.DISCOUNT_CURRENCY_MAPPING DISCOUNT_CURRENCY_MAPPING
		ON DISCOUNT_CURRENCY_MAPPING.DISCOUNT_CURRENCY_CODE = ECONOMIC_RATE.CURRENCY_CODE
		AND ECONOMIC_RATE.LOB_CODE = '30'
WHERE
	PARAMETER_TYPE.CODE IN ('YC', 'ZCR')
	AND DISCOUNT_CURRENCY_MAPPING.LOB_CODE = '30';